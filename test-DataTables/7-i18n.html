<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title></title>
	<meta charset="utf-8" />

    <!-- css -->
    <link href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
    <link href="//cdn.bootcss.com/datatables/1.10.8/css/dataTables.bootstrap.min.css" rel="stylesheet">
    <link href="//cdn.bootcss.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="//cdn.bootcss.com/bootstrap-datepicker/1.4.0/css/bootstrap-datepicker.min.css" rel="stylesheet">
    <link href="css/zTree/metroStyle/metroStyle.css" rel="stylesheet">

    <style>
        .modal .has-feedback .form-control {
            padding-right: 5px;
        }
        .modal .form-horizontal .form-group {
            margin: 0px
        }
        .input-daterange input {
            text-align: left;
        }
    </style>
</head>
<body>

    <!-- html -->
    <div class="container">
        <div class="row">
            <div class="panel panel-danger">
                <div class="panel-heading">
                    <h3 class="panel-title" data-i18n="7-i18n.panel-title">标题11</h3>
                </div>
                <div class="panel-body">
                    <div class="pull-right">
                        <button type="button" class="btn btn-sm btn-primary" id="btn_add"><i class="fa fa-plus"></i> <span data-i18n="7-i18n.btn_add">新增11</span></button>
                    </div>
                    <table class="table table-striped table-hover" id="table">
                        <thead></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <div id="modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h5 class="modal-title" data-i18n="7-i18n.modal-title">标题11</h5>
                        </div>
                        <div class="modal-body">

                            <form id="form1" method="post" class="form-horizontal"
                                  data-bv-message="This value is not valid"
                                  data-bv-feedbackicons-valid="glyphicon glyphicon-ok"
                                  data-bv-feedbackicons-invalid="glyphicon glyphicon-remove"
                                  data-bv-feedbackicons-validating="glyphicon glyphicon-refresh">

                                <div class="container-fluid">
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label" for="Name" data-i18n="7-i18n.Name">姓名11</label>
                                                <input class="form-control input-sm" id="Name" name="Name" data-field="Name" type="text" placeholder="" />
                                            </div>
                                        </div>
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label" for="Sex" data-i18n="7-i18n.Sex">性别11</label>
                                                <select class="form-control input-sm" id="Sex" name="Sex" data-field="Sex"></select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label" for="Birth" data-i18n="7-i18n.Birth">出生日期11</label>
                                                <input class="form-control input-sm input-date" id="Birth" name="Birth" data-field="Birth" type="text" placeholder="" data-date-format="yyyy-mm-dd" data-date-language="zh-CN" data-date-orientation="top auto" data-date-clear-btn="true" />
                                            </div>
                                        </div>
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label" for="Age" data-i18n="7-i18n.Age">年龄11</label>
                                                <input class="form-control input-sm" id="Age" name="Age" data-field="Age" type="text" placeholder="" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="input-daterange" data-date-format="yyyy-mm-dd" data-date-language="zh-CN" data-date-orientation="top auto" data-date-clear-btn="true">
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label" for="DateStart" data-i18n="7-i18n.DateStart">开始日期11</label>
                                                    <input class="form-control input-sm" id="DateStart" name="DateStart" data-field="DateStart" type="text" placeholder="" />
                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label" for="DateEnd" data-i18n="7-i18n.DateEnd">结束日期11</label>
                                                    <input class="form-control input-sm" id="DateEnd" name="DateEnd" data-field="DateEnd" type="text" placeholder="" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label" for="District" data-i18n="7-i18n.District">区域11</label>
                                                <div class="form-group">
                                                    <div class="ztree_dropdown" id="District"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label" for="CurrDistrict" data-i18n="7-i18n.CurrDistrict">当前区域11</label>
                                                <div class="form-group">
                                                    <div class="ztree_dropdown" id="CurrDistrict"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <div class="form-group">
                                                <label class="control-label" for="Memo" data-i18n="7-i18n.Memo">描述11</label>
                                                <textarea class="form-control input-sm" id="Memo" name="Memo" data-field="Memo" placeholder="" rows="3"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <div class="checkbox">
                                                <label>
                                                    <input type="checkbox" id="IsValid" name="IsValid" data-field="IsValid"> <span data-i18n="7-i18n.IsValid">是否有效11</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>

                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default btn-sm cancel" data-dismiss="modal"><i class="fa fa-times"></i> <span data-i18n="7-i18n.close">关闭11</span></button>
                            <button type="submit" class="btn btn-primary btn-sm save"><i class="fa fa-save"></i> <span data-i18n="7-i18n.save">保存11</span></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- js -->
    <script src="//cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>
    <script src="//cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="//cdn.bootcss.com/datatables/1.10.8/js/jquery.dataTables.min.js"></script>
    <script src="//cdn.bootcss.com/datatables/1.10.8/js/dataTables.bootstrap.min.js"></script>
    <script src="js/xy.datatables.js"></script>
    <script src="js/bootstrap-datepicker-xy.js"></script><!-- 临时修改：https://github.com/eternicode/bootstrap-datepicker/pull/1488  -->
    <script src="//cdn.bootcss.com/bootstrap-datepicker/1.4.0/locales/bootstrap-datepicker.zh-CN.min.js"></script>
    <script src="js/bootstrapValidator.js"></script>
    <script src="js/zTree/jquery.ztree.all-3.5.min.js"></script>
    <script src="js/xy.ztree.js"></script>
    <script src="js/i18next-1.10.1.js"></script>
    <script>

        $(function () {

            // i18n
            i18n.init({
                resGetPath: 'locales/__ns__-__lng__.json',
                getAsync: false,
                debug: true
            });
            $("[data-i18n]").i18n();


            // 性别下拉
            $("#Sex").append(String()
                + "<option value=''>" + i18n.t("7-i18n.ztree_emptyText") + "</option>"
                + "<option value='male'>" + i18n.t("7-i18n.male") + "</option>"
                + "<option value='female'>" + i18n.t("7-i18n.female") + "</option>");

            // 日期编辑框变化触发验证
            $("#Birth, #DateStart, #DateEnd").change(function () {
                $(this).triggerHandler("input");
            });

            // 区域下拉
            var zNodes = [
                { id: 1, pId: -1, name: i18n.t("7-i18n.shenzhen"), checked: false },
                { id: 2, pId: 1, name: i18n.t("7-i18n.luohu"), checked: false },
                { id: 3, pId: 1, name: i18n.t("7-i18n.futian"), checked: false },
                { id: 4, pId: 1, name: i18n.t("7-i18n.nanshan"), checked: false },
                { id: 5, pId: 1, name: i18n.t("7-i18n.yantian"), checked: false },
                { id: 6, pId: 1, name: i18n.t("7-i18n.baoan"), checked: false },
                { id: 7, pId: 1, name: i18n.t("7-i18n.longgang"), checked: false },
            ];
            new xy.ztree.dropdown({
                domId: "District",
                zNodes: zNodes,
                checkEnable: true,
                emptyText: i18n.t("7-i18n.ztree_emptyText")
            }).init();
            var treeObj = $.fn.zTree.getZTreeObj("ztree_District");
            treeObj.expandAll(true);

            // 当前区域下拉
            var zNodes_Curr = [
                { id: "", pId: -1, name: i18n.t("7-i18n.ztree_emptyText"), checked: false },
                { id: 1, pId: -1, name: i18n.t("7-i18n.shenzhen"), checked: false },
                { id: 2, pId: 1, name: i18n.t("7-i18n.luohu"), checked: false },
                { id: 3, pId: 1, name: i18n.t("7-i18n.futian"), checked: false },
                { id: 4, pId: 1, name: i18n.t("7-i18n.nanshan"), checked: false },
                { id: 5, pId: 1, name: i18n.t("7-i18n.yantian"), checked: false },
                { id: 6, pId: 1, name: i18n.t("7-i18n.baoan"), checked: false },
                { id: 7, pId: 1, name: i18n.t("7-i18n.longgang"), checked: false },
            ];
            new xy.ztree.dropdown({
                domId: "CurrDistrict",
                zNodes: zNodes_Curr,
            }).init();
            var treeObj_Curr = $.fn.zTree.getZTreeObj("ztree_CurrDistrict");
            treeObj_Curr.expandAll(true);

            // 验证声明
            $("#form1").bootstrapValidator({
                submitHandler: function (validator, form, submitButton) {
                    // Do nothing
                },
                fields: {
                    Name: {
                        validators: {
                            notEmpty: {
                                message: i18n.t("7-i18n.Name_notEmpty")
                            }
                        }
                    },
                    Sex: {
                        validators: {
                            notEmpty: {
                                message: i18n.t("7-i18n.Sex_notEmpty")
                            }
                        }
                    },
                    District: {
                        validators: {
                            notEmpty: {
                                message: i18n.t("7-i18n.District_notEmpty")
                            }
                        }
                    },
                    CurrDistrict: {
                        validators: {
                            notEmpty: {
                                message: i18n.t("7-i18n.CurrDistrict_notEmpty")
                            }
                        }
                    },
                    Birth: {
                        validators: {
                            notEmpty: {
                                message: i18n.t("7-i18n.Birth_notEmpty")
                            }
                        }
                    },
                    Age: {
                        validators: {
                            notEmpty: {
                                message: i18n.t("7-i18n.Age_notEmpty")
                            },
                            integer: {
                                message: i18n.t("7-i18n.Age_integer")
                            },
                            between: {
                                min: 0,
                                max: 100,
                                message: i18n.t("7-i18n.Age_between")
                            }
                        }
                    },
                    DateStart: {
                        validators: {
                            notEmpty: {
                                message: i18n.t("7-i18n.DateStart_notEmpty")
                            }
                        }
                    },
                    DateEnd: {
                        validators: {
                            notEmpty: {
                                message: i18n.t("7-i18n.DateEnd_notEmpty")
                            }
                        }
                    },
                },
                excluded: [],
            });

            // dataTables
            new xy.datatables({
                tableId: "table",
                btnAddId: "btn_add",
                modalId: "modal",
                optionDom: 'rt<"bottom"ip><"clear">',
                i18n: i18n,
                cols: [
                    { display: "ID", fieldName: "ID", visible: false, key: true },
                    { display: i18n.t("7-i18n.Name"), fieldName: "Name", visible: true },
                    { display: i18n.t("7-i18n.Sex"), fieldName: "Sex", visible: true, render: function (data, type, row) {
                        switch (data) {
                            case "male": return i18n.t("7-i18n.male");
                            case "female": return i18n.t("7-i18n.female");
                            default: return "";
                        }
                    } },
                    { display: i18n.t("7-i18n.Birth"), fieldName: "Birth", visible: true },
                    { display: i18n.t("7-i18n.Age"), fieldName: "Age", visible: true },
                    { display: i18n.t("7-i18n.DateStart"), fieldName: "DateStart", visible: true },
                    { display: i18n.t("7-i18n.DateEnd"), fieldName: "DateEnd", visible: true },
                    { display: i18n.t("7-i18n.District"), fieldName: "District", visible: true, render: function (data, type, row) {
                        var ret = "";
                        if (data != null) {
                            var array = data.split(",");
                            for (var i = 0; i < array.length; i++) {
                                var id = array[i];
                                for (var j = 0; j < zNodes.length; j++) {
                                    if (zNodes[j].id == id) {
                                        ret += zNodes[j].name + ",";
                                        break;
                                    }
                                }
                            }
                            if (array.length > 0)
                                ret = ret.substring(0, ret.length - 1);
                        }
                        return ret;
                    } },
                    { display: i18n.t("7-i18n.CurrDistrict"), fieldName: "CurrDistrict", visible: true, render: function (data, type, row) {
                        var ret = "";
                        if (data != null) {
                            for (var i in zNodes_Curr) {
                                if (zNodes_Curr[i].id == data)
                                    ret = zNodes_Curr[i].name;
                            }
                        }
                        return ret;
                    } },
                    { display: i18n.t("7-i18n.Memo"), fieldName: "Memo", visible: false },
                    { display: i18n.t("7-i18n.IsValid"), fieldName: "IsValid", visible: true, render: function (data, type, row) {
                        return data ? i18n.t("7-i18n.yes") : i18n.t("7-i18n.no");
                    } },
                    { display: "", fieldName: null, action: "Edit", visible: true }
                ],
                ajax: {
                    show: "server/ztree.ashx?Func=show" + "&date=" + new Date().getTime(), // 可以加其他查询条件
                    add: "server/ztree.ashx?Func=add" + "&date=" + new Date().getTime(), // 若有key则无需加查询条件
                    edit: "server/ztree.ashx?Func=edit" + "&date=" + new Date().getTime(), // 若有key则无需加查询条件
                    delete: "server/ztree.ashx?Func=delete" + "&date=" + new Date().getTime(), // 若有key则无需加查询条件
                },
                fnModalInit: function () {
                    $('#modal .input-date').datepicker('remove');
                    $('#modal .input-daterange').datepicker('remove');  // 1.4.0 会报错，解决方案为 https://github.com/eternicode/bootstrap-datepicker/pull/1488

                    return true;
                },
                fnModalShowing: function () {
                    $('#modal .input-date').datepicker();
                    $('#modal .input-daterange').datepicker();

                    // 清空验证标签
                    var bootstrapValidator = $("#form1").data('bootstrapValidator');
                    bootstrapValidator.resetForm(false);
                },
                fnModalSubmitting: function () {
                    var bootstrapValidator = $("#form1").data('bootstrapValidator')
                    return bootstrapValidator.validate().isValid();
                },
                fnDrawn: function () {
                }
            }).init();

        })

    </script>

</body>
</html>
